---
title: "test_gps_overlap"
author: "David"
date: "2/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE)
```

```{r load packages}
#Load necessary packages
library(lubridate)
library(tidyverse)
library(overlap)
library(circular)
library(CircStats)
library(adehabitatLT)
library(here)
library(glue)
```

Bring in GPS from Florida male pigs in the summer.
```{r import data}
#Import gps data from males in the fall
df <- read.csv(here("data/sex_comparisons/BIR_SummerGPS_Males.csv")) 
df15<-df %>% filter(Year==2015)
df16<-df %>% filter(Year==2016)
df17<-df %>% filter(Year==2017)
```

Function to pre-process
```{r}
pre_process<-function(df, date, x, y, id){
  dates <- as.POSIXct(strptime(as.character(df[,date]),"%Y/%m/%d %H:%M", tz="America/New_York"))
  traj_obj <- as.ltraj(xy = df[,c(x,y)], date = dates,
                             id = df[,id], typeII= TRUE, burst = df[,id])

ld_df <- ld(traj_obj) #converts from ltraj object back to dataframe

ld_df<-ld_df %>% 
  mutate(dtmin=dt/60,   # create a new column for amount of time between points in minutes
         dthr=dt/3600,  # create a new column for time between points in hours
         meterph=round(dist/dthr, digits=0))%>%  # calculate movement rate in meters per hour, rounds to nearest integer
  dplyr::select(id, x, y, date, dist,dt, dtmin, dthr, meterph) 
}
```

Apply pre-process function
```{r}
df15<-pre_process(df = df15, date = "Fix_DateTime", x = "X", y="Y", id="Indiv_ID")
df16<-pre_process(df = df16, date = "Fix_DateTime", x = "X", y="Y", id="Indiv_ID")
df17<-pre_process(df = df17, date = "Fix_DateTime", x = "X", y="Y", id="Indiv_ID")
```

Function to take a dataframe of multiple pigs, generate pseudo-observations, and generate an activity kernel.  
Store the activity kernel for each pig as a single column the output dataframe.  
It is assumed that each input dataframe will come from the pre-process function above and have the columns:
- dtmin
- meterph
- date
- id
```{r}
rad_positions<-"0,0.1889764,0.3779528,0.5669291,0.7559055,0.9448819,1.1338583,1.3228346,1.511811,1.7007874,1.8897638,2.0787402,2.2677165,2.4566929,2.6456693,2.8346457,3.023622,3.2125984,3.4015748,3.5905512,3.7795276,3.9685039,4.1574803,4.3464567,4.5354331,4.7244094,4.9133858,5.1023622,5.2913386,5.480315,5.6692913,5.8582677,6.0472441,6.2362205,6.4251969,6.6141732,6.8031496,6.992126,7.1811024,7.3700787,7.5590551,7.7480315,7.9370079,8.1259843,8.3149606,8.503937,8.6929134,8.8818898,9.0708661,9.2598425,9.4488189,9.6377953,9.8267717,10.015748,10.2047244,10.3937008,10.5826772,10.7716535,10.9606299,11.1496063,11.3385827,11.5275591,11.7165354,11.9055118,12.0944882,12.2834646,12.4724409,12.6614173,12.8503937,13.0393701,13.2283465,13.4173228,13.6062992,13.7952756,13.984252,14.1732283,14.3622047,14.5511811,14.7401575,14.9291339,15.1181102,15.3070866,15.496063,15.6850394,15.8740157,16.0629921,16.2519685,16.4409449,16.6299213,16.8188976,17.007874,17.1968504,17.3858268,17.5748031,17.7637795,17.9527559,18.1417323,18.3307087,18.519685,18.7086614,18.8976378,19.0866142,19.2755906,19.4645669,19.6535433,19.8425197,20.0314961,20.2204724,20.4094488,20.5984252,20.7874016,20.976378,21.1653543,21.3543307,21.5433071,21.7322835,21.9212598,22.1102362,22.2992126,22.488189,22.6771654,22.8661417,23.0551181,23.2440945,23.4330709,23.6220472,23.8110236,24"


activity_kernel<-function(df){
  ids<-unique(df[,id])
  out<-data.frame(id=ids, 
                  time_rad=
  
  
  
  
  
  
  
}








```








































